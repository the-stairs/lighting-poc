# 📑 기능명세서 (렌더링 개선 반영 버전)

## 📂 프로젝트 구조

```
your-light-simulator/
│
├── index.html      # p5.js, 패널 UI 포함
├── main.js         # 캔버스 관리, 이벤트 핸들링, 조명 배열 관리
├── shader.frag     # 프래그먼트 쉐이더 (inverse-square falloff, 핫스폿, 페널브라)
├── shader.vert     # 버텍스 쉐이더 (기본 full-screen quad)
├── ui.js           # 패널 이벤트/단축키 처리
├── styles.css      # 패널 및 캔버스 레이아웃 스타일
└── assets/         # 리소스 (아이콘 등)
```

---

## 🔢 개발 우선순위

1. **쉬운 기능**

   - 배경 색상 설정
   - 조명 삭제
   - 패널 토글 (숨김 시 선택 해제)

2. **핵심 기능**

   - 조명 생성 (클릭 기반)
   - 조명 선택/이동
   - 조명 속성 제어 (슬라이더·팔레트)
   - 여러 조명 동시 생성

3. **어려운 기능**

   - 빛 블렌딩 효과 (Additive + 강도 조절)
   - 쉐이더 기반 라이트 렌더링 (inverse-square falloff, 핫스폿·페널브라)

---

## 🖥️ 기능별 명세

### 1. 배경 색상 설정 (쉬움)

- **UI 요소**: 팔레트(color picker), 버튼(검정/회색)
- **동작**: 선택된 색상을 배경색으로 즉시 반영
- **파일 위치**:

  - `index.html` → `<input type="color">`, 버튼 2개
  - `ui.js` → 이벤트 리스너
  - `main.js` → `background()` 갱신

- **테스트 체크리스트**:

  - 초기값: 검정
  - 버튼으로 회색 전환 가능
  - 팔레트 선택 즉시 반영

---

### 2. 조명 생성 (클릭 기반) (핵심)

- **동작**: 캔버스 클릭 시 새로운 조명 추가
- **모양 옵션**: 원형 / 사각형 (라디오 버튼 선택)
- **파일 위치**:

  - `main.js` → `mousePressed()`에서 `lights[]`에 push

- **테스트 체크리스트**:

  - 클릭 시 조명 생성
  - 모양 선택 반영됨

---

### 3. 조명 선택/이동 (핵심)

- **동작**:

  - 클릭 → 조명 선택
  - 드래그 → 위치 이동

- **UI 반영**:

  - 선택 상태 하이라이트
  - 패널 값 갱신

- **파일 위치**:

  - `main.js` → `mousePressed()` (hit test), `mouseDragged()` (좌표 업데이트)

- **테스트 체크리스트**:

  - 선택/전환 정상 동작
  - 이동 시 실시간 반영

---

### 4. 조명 속성 제어 (패널 UI) (핵심)

- **UI 요소**:

  - 크기 슬라이더 (원형 radius / 사각형 width,height)
  - 밝기 슬라이더 (**HDR 스케일 0\~2000**)
  - 그라데이션 슬라이더 (softness)
  - 색상 팔레트

- **동작**:

  - 값 변경 시 선택 조명 속성이 즉시 반영

- **파일 위치**:

  - `ui.js` → 슬라이더/팔레트 이벤트
  - `main.js` → 선택된 조명 업데이트

- **테스트 체크리스트**:

  - 속성 변경이 실시간 반영됨
  - 밝기 확장 범위에서 고휘도 표현됨
  - 선택 해제 시 패널 비활성화됨

---

### 5. 여러 조명 동시 생성 (핵심)

- **동작**:

  - 여러 번 클릭 시 누적 생성
  - 개별 선택/제어 가능

- **파일 위치**:

  - `main.js` → `lights[]` 배열로 관리

- **테스트 체크리스트**:

  - 다수 조명 배치 가능
  - 개별 속성 조절 가능

---

### 6. 조명 삭제 (쉬움)

- **동작**:

  - 패널 내 “삭제” 버튼
  - 더블클릭 제스처

- **파일 위치**:

  - `ui.js` → 버튼 이벤트
  - `main.js` → `mouseClicked()`에서 더블클릭 판별

- **테스트 체크리스트**:

  - 버튼 삭제 동작
  - 더블클릭 삭제 동작
  - 삭제 후 선택 해제 상태

---

### 7. 패널 토글 (쉬움)

- **동작**:

  - 단축키(`P`) 또는 버튼
  - 패널 숨김 시 **선택 해제**

- **파일 위치**:

  - `ui.js` → 단축키, 토글 버튼
  - `styles.css` → display 전환

- **테스트 체크리스트**:

  - 토글로 패널 보이기/숨기기 가능
  - 숨김 시 선택 해제됨
  - 다시 열면 비선택 상태로 유지

---

### 8. 빛 블렌딩 효과 (어려움)

- **동작**:

  - Additive Blending (`blendMode(ADD)`)
  - 블렌딩 강도: 슬라이더 제어

- **파일 위치**:

  - `main.js` → draw() 루프에서 blendMode 적용
  - `ui.js` → 슬라이더 이벤트

- **테스트 체크리스트**:

  - 조명 겹침 시 밝기 합성됨
  - 강도 조절 시 효과 차이 반영됨

---

### 9. 쉐이더 기반 라이트 렌더링 (어려움)

- **렌더링 방식**:

  - **프래그먼트 쉐이더** 사용
  - inverse-square falloff (빛 강도 ∝ 1/r²)
  - Hotspot + Penumbra(부드러운 경계)
  - Linear 색 공간 연산 후 sRGB 변환

- **파일 위치**:

  - `shader.vert` → full-screen quad
  - `shader.frag` → 라이트 연산 (색, 밝기, falloff)
  - `main.js` → p5.js `createShader()` 활용

- **테스트 체크리스트**:

  - 단순 원형 그라데이션이 아닌 실제 조명 느낌
  - 중심부는 강한 빛, 외곽은 부드럽게 감쇠
  - 색상/밝기 변화가 물리적으로 자연스러움

---

## ✅ 최종 테스트 플로우

1. 실행 시 배경은 검정 → 회색·팔레트 변경 확인
2. 캔버스 클릭 → 조명 생성 (모양 반영)
3. 조명 클릭 → 선택 및 패널 값 표시
4. 드래그로 위치 이동 확인
5. 패널에서 크기·밝기(HDR 스케일)·그라데이션·색상 변경 → 즉시 반영
6. 여러 조명 생성 후 개별 제어 확인
7. 삭제 버튼·더블클릭으로 조명 제거 확인
8. 패널 토글(`P`) → 패널 숨김/선택 해제 동작 확인
9. 조명 겹침 시 Additive Blending 효과 확인
10. 쉐이더 렌더링으로 inverse-square falloff 및 핫스폿·페널브라 표현 확인

---
